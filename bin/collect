#!/usr/bin/env node

/**
 * Module dependencies.
 */

var dgram = require("dgram");
var Collector = require('../libs/collector');

/*
 *  UDP server
 */
var PORT = 9995;

var udpserver = dgram.createSocket("udp6");
var collector = new Collector();

udpserver.on("error", function (err) {
  console.log("server error:\n" + err.stack);
  udpserver.close();
});


udpserver.on("message", function (msg, rinfo) {
  var buf = new Buffer(msg, 'hex');
  console.log("Received msg from " +
    rinfo.address + ":" + rinfo.port +
    "( " + msg.length + " bytes)");
  console.log(ipfix.parse(msg));
  collector.processMsg(msg);
});


udpserver.on("listening", function () {
  var address = udpserver.address();
  console.log("server listening " +
      address.address + ":" + address.port);
});

udpserver.bind(PORT);
